{% extends "base.html" %}
{% load i18n %}

{% block content %}
<h1>{{ result.scanbinding.scan.tag.release.description }}</h1>
<h2>{{ result.scanbinding.scan.nvr }} {% trans "compared to" %} {{ result.scanbinding.scan.base.nvr }} </h2>

<table class="summary">
    <tr>
        <td class="IS_A_BUG">
            Is a bug
        </td>
        <td class="NEEDS_INSPECTION">
            Needs Inspection
        </td>
        <td class="INFO">
            Info
        </td>
        <td class="WAIVED">
            Waived
        </td>
        <td class="PASSED">
            Passed
        </td>
        <td class="PREVIOUSLY_WAIVED">
            Previously Waived
        </td>
    </tr>
</table>

<h3>Newly introduced defects</h3>
{% if output_new %}
<table class="summary">
{% for five in output_new %}
  <tr>
    {% for group, data in five.items %}
        {% if data and data.id %}
        <td {% if active_group and active_group.id == data.id %}
            id="active"
            {% endif %}
            class="{{ data.group_state }}">
            <a href="{% url waiving/waiver result.id data.id %}#defects">{{ group.name }}</a>
            {% if data.defects_state %}
            <span class="{{ data.defects_state }}">{{ data.defects_count }}</span>
            {% endif %}
            {% if data.diff_state %}
            <span class="{{ data.diff_state }}">{{ data.diff_count }}</span>
            {% endif %}
        </td>
        {% else %}
        <td class="PASSED">
            {{ group.name }}
            {% if data.diff_state %}
            <span class="{{ data.diff_state }}">{{ data.diff_count }}</span>
            {% endif %}
        </td>
        {% endif %}
    {% endfor %}
  </tr>
{% endfor %}
</table>
{% endif %}

<h3>Fixed defects</h3>
{% if output_fixed %}
<table class="summary">
{% for five in output_fixed %}
  <tr>
    {% for group, data in five.items %}
        {% if data and data.id %}
        <td {% if active_group and active_group.id == data.id %}
            id="active"
            {% endif %}
            class="{{ data.group_state }}">
            <a href="{% url waiving/fixed_defects result.id data.id %}#defects">{{ group.name }}</a>
            {% if data.defects_state %}
            <span class="{{ data.defects_state }}">{{ data.defects_count }}</span>
            {% endif %}
            {% if data.diff_state %}
            <span class="{{ data.diff_state }}">{{ data.diff_count }}</span>
            {% endif %}
        </td>
        {% else %}
        <td class="PASSED">
            {{ group.name }}
            {% if data.diff_state %}
            <span class="{{ data.diff_state }}">{{ data.diff_count }}</span>
            {% endif %}
        </td>
        {% endif %}
    {% endfor %}
  </tr>
{% endfor %}
</table>
{% endif %}

{% if task %}
<a href="{% url task/detail task.id %}">Task</a>
{% endif %}

{% if logs %}
<div>
<ul>
{% for log, log_label in logs.iteritems %}
  <li><a href="{% url task/log result.scanbinding.task.id log %}">{{ log_label }}</a> [<a href="{% url task/log result.scanbinding.task.id log %}?format=raw">download</a>]</li>
{% endfor %}
</ul>
</div>
{% endif %}

{% if previous_result or next_result %}
<div id="result_links">
    {% if previous_result %}
    <span><a href="{% url waiving/result previous_result.id %}">Previous scan ({{ previous_result.nvr }})</a></span>
    {% endif %}
    {% if previous_result and next_result %} | {% endif %}
    {% if next_result %}
    <span><a href="{% url waiving/result next_result.id %}">Next scan ({{ next_result.nvr }})</a></span>
    {% endif %}
</div>
{% endif %}

{% block waiver %}
{% endblock waiver %}

{% endblock content %}
