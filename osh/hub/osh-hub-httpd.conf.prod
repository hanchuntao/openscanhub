#ServerName localhost
WSGISocketPrefix /var/run/wsgi

<VirtualHost *:80>
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
</VirtualHost>

<VirtualHost *:443>
    # WSGI handler
    WSGIDaemonProcess covscan display-name=%{GROUP} locale='C.UTF-8'
    WSGIProcessGroup covscan
    WSGIScriptAlias /covscanhub /usr/lib/python3.6/site-packages/osh/hub/covscanhub.wsgi process-group=covscan

    SSLEngine on
    SSLCertificateFile      /etc/httpd/conf/cov01.lab.eng.brq2.redhat.com.crt
    SSLCertificateKeyFile   /etc/httpd/conf/cov01.lab.eng.brq2.redhat.com.key
    SSLCertificateChainFile /etc/httpd/conf/cov01.lab.eng.brq2.redhat.com-ca.crt

    # needed for Apache 2.4
    <Directory "/usr/lib/python3.6/site-packages/osh/hub">
        Require all granted
    </Directory>

    # static stuff
    Alias /covscanhub/static/ "/usr/lib/python3.6/site-packages/osh/hub/static/"
    <Directory "/usr/lib/python3.6/site-packages/osh/hub/static/">
        Options Indexes
        IndexOptions FancyIndexing
    </Directory>

    <Location "/covscanhub/xmlrpc/kerbauth/">
        AuthType GSSAPI
	GssapiCredStore keytab:/etc/httpd/conf/httpd.keytab
        AuthName "Covscan XML-RPC Interface"
        Require valid-user
    </Location>

    <Location "/covscanhub/auth/krb5login/">
        AuthType GSSAPI
	GssapiCredStore keytab:/etc/httpd/conf/httpd.keytab
        AuthName "Covscan WEB-UI Login"
        Require valid-user
    </Location>
</VirtualHost>
